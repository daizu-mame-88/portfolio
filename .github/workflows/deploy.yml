name: Deploy to GitHub Pages

# mainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ãŒã‚ã£ãŸã¨ãã«ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
on:
  push:
    branches:
      - main 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ (å¤‰æ›´ãªã—)
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 
      
      # 2. Node.jsç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (å¤‰æ›´ãªã—)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      
      # 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (å¤‰æ›´ãªã—)
      - name: Install dependencies
        run: npm install

      # 4. Astroã®ãƒ“ãƒ«ãƒ‰ (å¤‰æ›´ãªã—)
      - name: Build Astro site
        run: npm run build
        
      # ğŸŒŸ 4.5. GitHub Pages æˆæœç‰©ã®è¨­å®š (è¿½åŠ ) ğŸŒŸ
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # ğŸŒŸ 4.6. ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (è¿½åŠ ) ğŸŒŸ
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3 # Pageså°‚ç”¨ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
        with:
          path: dist # Astroã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ãŒå‡ºåŠ›ã•ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

      # 5. GitHub Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ (å¤‰æ›´ãªã—)
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 
        # artifacts ã®æŒ‡å®šã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸã€‚deploy-pagesãŒè‡ªå‹•ã§ 'github-pages' ã‚’æ¢ã—ã¾ã™ã€‚
        # with: ã®ä¸­èº«ã‚‚ä¸è¦ã§ã™ã€‚